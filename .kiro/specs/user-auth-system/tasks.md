# 实现计划：用户认证系统

## 概述

本实现计划将用户认证系统分为后端和前端两个主要部分。后端使用Spring Boot + MySQL，前端使用Android Kotlin + Jetpack Compose。实现顺序遵循从基础到高级、从后端到前端的原则，确保每个步骤都可以独立测试和验证。

## 项目文件夹结构

```
user-auth-system/
├── android-app/          # Android应用（所有Android代码和测试）
├── backend/              # Spring Boot后端（所有后端代码和测试）
├── docs/                 # 文档和设计资料
└── scripts/              # 部署和工具脚本
```

**重要说明：**
- **不使用独立的test文件夹**：测试代码应该位于各自项目内部
- **Android测试位置**：
  - 单元测试：`android-app/app/src/test/`
  - UI测试：`android-app/app/src/androidTest/`
- **后端测试位置**：
  - 所有测试：`backend/src/test/`（包括单元测试、集成测试、属性测试）
- **文档位置**：`docs/`（API文档、部署指南等）
- **脚本位置**：`scripts/`（数据库初始化、部署脚本等）

## 任务

### 第一阶段：开发环境和基础设施

- [x] 1. 搭建统一的容器化开发环境
  - [x] 1.1 创建Docker Compose开发环境配置
    - 创建`docker-compose.dev.yml`，包含MySQL、Redis、后端服务
    - 配置数据卷持久化和热重载支持
    - 配置环境变量管理（.env.dev文件）
    - 支持一键启动所有服务：`docker-compose -f docker-compose.dev.yml up -d`
    - _解决问题：统一本地开发环境，消除"在本地跑得好，在CI/生产跑坏"的问题_
  
  - [x] 1.2 配置CI/CD流水线（GitHub Actions）
    - 创建`.github/workflows/ci.yml`，支持并行构建Android和后端
    - 配置自动化测试：后端单元测试、集成测试、Android单元测试、UI测试
    - 配置代码质量检查：SonarQube扫描、安全漏洞扫描
    - 配置自动部署：测试环境自动部署，生产环境手动审批
    - _解决问题：缺乏统一CI/CD流水线，团队协作成本高_
  
  - [x] 1.3 搭建Spring Boot项目基础结构
    - 在`backend/`文件夹中创建Spring Boot项目，配置Maven/Gradle依赖
    - 配置多环境配置文件：`application.yml`、`application-dev.yml`、`application-test.yml`、`application-prod.yml`
    - 配置Spring Security和JWT依赖
    - 配置CORS以支持Android客户端
    - 配置Actuator健康检查端点
    - _需求：12.1, 12.2, 12.3_

- [x] 2. 创建数据库表结构和迁移
  - [x] 2.1 配置数据库迁移工具
    - 配置Flyway数据库迁移工具
    - 在`backend/src/main/resources/db/migration/`中创建版本化迁移脚本
    - 确保迁移脚本在MySQL测试环境和生产环境中行为一致
    - _解决问题：测试环境与生产环境数据库不一致的潜在风险_
  
  - [x] 2.2 创建数据库表结构
    - 编写SQL迁移脚本创建所有数据库表
    - 在`scripts/test-data.sql`中插入水果营养和风味的预置测试数据（芒果和香蕉）
    - 创建数据库索引优化查询性能
    - _需求：9.1, 9.2, 9.3, 9.1.1-9.1.11, 10.1-10.9_
  
  - [x] 2.3 配置容器化测试环境
    - 创建`docker-compose.test.yml`，使用MySQL容器替代H2
    - 配置TestContainers集成测试环境
    - 确保测试数据库与生产数据库版本和配置一致
    - _解决问题：H2与MySQL的SQL方言差异可能导致测试通过但生产失败_

- [x] 3. 安全配置和密钥管理
  - [x] 3.1 配置生产级安全设置
    - 配置HTTPS/TLS证书管理（Let's Encrypt自动续期）
    - 配置JWT密钥管理和轮换策略
    - 配置密码策略和BCrypt加密强度
    - 配置CORS、CSRF、XSS防护
    - _解决问题：安全与合规性细节未在快速启动中覆盖_
  
  - [x] 3.2 配置环境变量和密钥管理
    - 使用环境变量管理敏感配置（数据库密码、JWT密钥等）
    - 配置Docker Secrets用于生产环境密钥管理
    - 实现密钥轮换和过期监控机制
    - _解决问题：密钥管理、证书更新等落地细节缺失_

- [x] 2.4 编写数据库表结构的集成测试（使用MySQL容器）

  - 在`backend/src/test/java/`中创建测试类
  - 使用TestContainers MySQL容器替代H2内存数据库
  - 测试用户名唯一性约束、外键约束在真实MySQL环境中的行为
  - 测试Flyway迁移脚本的执行和回滚
  - 可通过Maven/Gradle命令独立执行：`mvn test` 或 `gradle test`
  - _解决问题：消除H2与MySQL环境差异，确保测试环境与生产环境一致_
  - _需求：9.3_

### 第二阶段：用户认证后端

- [x] 3. 实现用户认证核心功能
  - [x] 3.1 创建User实体（JPA）
    - 实现User实体类，包含username, passwordHash, isAdmin字段
    - isAdmin字段默认为false，标识管理员权限
    - _需求：1.1, 9.2, 9.6, 9.7_
  
  - [x] 3.2 实现密码哈希服务
    - 使用BCrypt实现密码哈希
    - 实现密码验证方法
    - _需求：1.5, 11.1, 11.2, 11.3_
  
  - [ ]* 3.3 编写密码哈希的属性测试（后端独立测试）
    - **属性 4: 密码安全存储**
    - **属性 31: 密码哈希比较**
    - 使用jqwik框架进行属性测试
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：1.5, 11.1, 11.3**
  
  - [x] 3.4 实现JWT令牌服务
    - 实现令牌生成方法，包含用户信息和角色
    - 实现令牌验证方法
    - 配置令牌过期时间
    - _需求：2.1, 2.4, 6.6, 11.5_
  
  - [ ]* 3.5 编写JWT令牌的属性测试（后端独立测试）
    - **属性 9: 令牌有效性**
    - **属性 10: 令牌包含过期时间**
    - 使用jqwik框架进行属性测试
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：2.4, 11.5**

- [x] 4. 实现用户注册API
  - [x] 4.1 创建注册请求DTO和响应DTO
    - 实现RegisterRequest类
    - 实现UserResponse类
    - _需求：1.1, 1.6_
  
  - [x] 4.2 实现用户注册Service层
    - 实现用户名验证逻辑（长度、字符限制）
    - 实现密码验证逻辑（最小长度）
    - 实现重复用户名检查
    - 实现用户创建和保存逻辑
    - _需求：1.1, 1.2, 1.3, 1.4, 1.7_
  
  - [x] 4.3 实现注册Controller
    - 创建POST /api/auth/register端点
    - 实现请求验证和错误处理
    - 返回201 Created状态码
    - _需求：8.1, 8.14_
  
  - [ ]* 4.4 编写用户注册的属性测试（后端独立测试）
    - **属性 1: 有效注册创建用户**
    - **属性 2: 重复用户名被拒绝**
    - **属性 3: 无效密码被拒绝**
    - **属性 5: 注册响应包含用户信息**
    - **属性 29: 用户数据持久化**
    - **属性 30: 用户名唯一性约束**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：1.1, 1.2, 1.3, 1.4, 1.6, 1.7, 9.2, 9.3**

- [x] 5. 实现用户登录API
  - [x] 5.1 创建登录请求DTO和响应DTO
    - 实现LoginRequest类
    - 实现AuthResponse类（包含token和用户信息）
    - _需求：2.1_
  
  - [x] 5.2 实现登录Service层
    - 实现用户名查找逻辑
    - 实现密码验证逻辑
    - 实现令牌生成逻辑
    - _需求：2.1, 2.2, 2.3_
  
  - [x] 5.3 实现登录Controller
    - 创建POST /api/auth/login端点
    - 实现认证失败处理（返回401）
    - _需求：8.2, 8.15, 8.16_
  
  - [ ]* 5.4 编写用户登录的属性测试（后端独立测试）
    - **属性 6: 有效凭证返回令牌**
    - **属性 7: 错误密码被拒绝**
    - **属性 8: 不存在的用户名被拒绝**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：2.1, 2.2, 2.3**

- [x] 6. 检查点 - 确保认证功能正常
  - 测试用户注册和登录流程
  - 验证JWT令牌生成和验证
  - 确保所有测试通过，询问用户是否有问题

### 第三阶段：权限管理后端

- [x] 7. 实现基于管理员的访问控制
  - [x] 7.1 配置Spring Security
    - 配置JWT过滤器
    - 配置权限拦截器
    - 实现管理员权限检查（基于isAdmin字段）
    - _需求：6.1, 6.2, 6.5_
  
  - [x] 7.2 实现权限验证注解
    - 创建自定义注解@RequireAdmin
    - 实现权限验证切面
    - _需求：6.5, 6.10_
  
  - [ ]* 7.3 编写权限管理的属性测试（后端独立测试）
    - **属性 11: 管理员权限**
    - **属性 12: 非管理员权限限制**
    - **属性 14: 权限验证**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点权限控制
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：6.2, 6.3, 6.5**

### 第四阶段：评价模型和赛事系统后端

- [x] 8. 实现评价模型管理API
  - [x] 8.1 创建评价模型实体和DTO
    - 实现EvaluationModel实体
    - 实现EvaluationParameter实体（包含name和weight字段）
    - 实现ModelRequest和ModelResponse DTO
    - _需求：9.1.1, 9.1.2_
  
  - [x] 8.2 实现评价模型Service层
    - 实现模型创建逻辑（验证总分值为100）
    - 实现模型查询逻辑
    - 实现模型更新逻辑（验证总分值为100）
    - 实现模型删除逻辑（检查是否被赛事使用）
    - 实现预设"芒果"评价模型的初始化
    - _需求：6.2.1-6.2.14_
  
  - [x] 8.3 实现评价模型Controller
    - 创建GET /api/evaluation-models端点（所有用户可访问）
    - 创建POST /api/evaluation-models端点（仅管理员）
    - 创建GET /api/evaluation-models/{id}端点（所有用户可访问）
    - 创建PUT /api/evaluation-models/{id}端点（仅管理员）
    - 创建DELETE /api/evaluation-models/{id}端点（仅管理员）
    - 添加@RequireAdmin权限验证
    - _需求：8.4, 8.5, 6.2.2_
  
  - [x] 8.4 编写评价模型的属性测试（后端独立测试）

    - **属性 15: 非管理员无法访问模型管理**
    - **属性 16: 模型创建持久化**
    - **属性 17: 被使用的模型不能删除**
    - **属性 18: 评价模型总分值验证**
    - **属性 19: 预设芒果模型**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：6.2.2, 6.2.10, 6.2.13, 6.2.14, 9.1.8**

- [x] 9. 实现文件上传功能
  - [x] 9.1 配置文件存储
    - 配置文件存储路径
    - 实现文件存储Service
    - _需求：10.1.4_
  
  - [x] 9.2 实现文件上传验证
    - 实现文件格式验证（JPG, PNG, WEBP）
    - 实现文件大小验证（最大10MB）
    - 实现唯一文件名生成
    - _需求：10.1.2, 10.1.3, 10.1.5_
  
  - [x] 9.3 实现文件访问API
    - 创建GET /api/files/{filename}端点
    - 实现文件下载逻辑
    - _需求：10.1.7_
  
  - [ ]* 9.4 编写文件上传的属性测试（后端独立测试）
    - **属性 25: 文件格式验证**（保留原编号）
    - **属性 26: 文件大小验证**
    - **属性 27: 文件存储持久化**
    - **属性 28: 文件名唯一性**
    - 使用jqwik框架进行属性测试
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：10.1.2, 10.1.3, 10.1.4, 10.1.5**

- [x] 10. 实现赛事管理API
  - [x] 10.1 创建赛事实体和DTO
    - 实现Competition实体（包含modelId字段）
    - 实现CompetitionEntry实体（参赛作品）
    - 实现CompetitionJudge实体（赛事评委）
    - 实现CompetitionRequest和CompetitionResponse DTO
    - _需求：9.1.3, 9.1.4, 9.1.5_
  
  - [x] 10.2 实现赛事Service层
    - 实现赛事创建逻辑（验证评价模型存在）
    - 实现赛事查询逻辑
    - 实现参赛作品上传逻辑
    - 实现评委管理逻辑
    - 实现赛事状态自动更新逻辑（定时任务）
    - _需求：6.3.1-6.3.16_
  
  - [x] 10.3 实现赛事Controller
    - 创建GET /api/competitions端点
    - 创建POST /api/competitions端点（仅管理员）
    - 创建GET /api/competitions/{id}端点
    - 创建POST /api/competitions/{id}/entries端点（仅管理员）
    - 添加权限验证
    - _需求：8.6, 8.7, 8.8_
  
  - [x] 10.4 编写赛事管理的属性测试（后端独立测试）

    - **属性 20: 赛事必须关联评价模型**
    - **属性 21: 已结束赛事拒绝评分提交**
    - **属性 22: 截止时间后拒绝提交**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：6.3.3, 6.3.13, 6.4.19**

- [x] 11. 实现评分API
  - [x] 11.1 创建评分实体和DTO
    - 实现CompetitionRating实体（包含parameterId和score字段）
    - 实现RatingRequest和RatingResponse DTO
    - _需求：9.1.6, 9.1.7_
  
  - [x] 11.2 实现评分Service层
    - 实现评分提交逻辑（验证评分范围：0到参数权重）
    - 实现评分修改逻辑
    - 实现截止时间验证
    - 实现赛事状态验证
    - 实现评分完整性验证（必须为所有参数评分）
    - _需求：6.4.1-6.4.20_
  
  - [x] 11.3 实现评分Controller
    - 创建POST /api/ratings端点
    - 添加权限验证（评委）
    - 实现截止时间检查
    - 实现评分范围验证
    - _需求：8.9_
  
  - [ ]* 11.4 编写评分的属性测试（后端独立测试）
    - **属性 23: 评分基于评价模型参数**
    - **属性 24: 评分范围验证**
    - **属性 25: 评分可修改**
    - **属性 26: 评分数据完整性**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：6.4.5, 6.4.6, 6.4.7, 6.4.20**

- [x] 12. 实现评分数据展示和导出API
  - [x] 12.1 实现数据查询Service
    - 实现赛事评分数据汇总逻辑
    - 实现各参数平均分计算逻辑
    - 实现总平均分计算逻辑
    - 实现参赛作品级数据统计逻辑
    - _需求：6.5.1-6.5.13_
  
  - [x] 12.2 实现数据展示Controller
    - 创建GET /api/ratings/{competitionId}端点
    - 实现数据格式化逻辑（包含各参数平均分和总平均分）
    - _需求：8.10_
  
  - [x] 12.3 实现CSV导出功能
    - 实现CSV生成逻辑（包含所有参数评分）
    - 创建GET /api/competitions/{id}/export端点
    - 添加权限验证（仅管理员）
    - _需求：8.11, 6.5.10, 6.5.11, 6.5.12_
  
  - [ ]* 12.4 编写数据导出的属性测试（后端独立测试）
    - **属性 27: 各参数平均分计算**
    - **属性 28: 总平均分计算**
    - **属性 29: 评分数据导出完整性**
    - 使用jqwik框架进行属性测试
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：6.5.3, 6.5.4, 6.5.11**

- [x] 13. 检查点 - 确保赛事评价系统功能正常
  - 测试评价模型创建和管理
  - 测试赛事创建和参赛作品上传
  - 测试评分提交和数据展示
  - 确保所有测试通过，询问用户是否有问题

### 第五阶段：水果营养查询后端

- [x] 14. 实现水果营养查询API
  - [x] 14.1 创建水果数据实体和DTO
    - 实现Fruit实体
    - 实现NutritionData实体
    - 实现FlavorData实体
    - 实现FruitQueryResponse DTO
    - _需求：10.1-10.9_
  
  - [x] 14.2 实现水果查询Service层
    - 实现按查询类型和水果名称查询逻辑
    - 实现数据格式化逻辑
    - _需求：10.6, 10.7_
  
  - [x] 14.3 实现水果查询Controller
    - 创建GET /api/fruit/query端点
    - 实现参数验证
    - 实现404错误处理
    - _需求：8.3, 8.17, 8.18, 8.20_
  
  - [ ]* 14.4 编写水果查询的属性测试（后端独立测试）
    - **属性 22: 未完成选择显示提示**（前端验证，后端测试参数缺失情况）
    - **属性 23: 有效查询返回数据**
    - **属性 24: 不存在的水果返回404**
    - 使用jqwik框架进行属性测试
    - 使用MockMvc测试API端点
    - 可通过Maven/Gradle命令独立执行
    - **验证需求：10.6, 10.7**

- [x] 15. 检查点 - 确保后端所有功能正常
  - 运行所有后端测试
  - 测试所有API端点
  - 验证权限控制
  - 确保所有测试通过，询问用户是否有问题

### 第六阶段：Android应用基础和自动化测试

- [x] 16. 搭建Android项目基础结构和CI集成
  - [x] 16.1 创建Android项目基础结构
    - 在`android-app/`文件夹中创建Android项目，配置Kotlin和Jetpack Compose
    - 配置Retrofit依赖（HTTP客户端）
    - 配置Navigation Compose依赖
    - 配置Hilt依赖（依赖注入）
    - 在`android-app/app/src/main/java/`中创建基础包结构（ui, data, domain）
    - _需求：3.1, 4.1_
  
  - [x] 16.2 配置Android CI/CD集成
    - 配置GitHub Actions中的Android构建和测试
    - 配置Android模拟器容器，支持UI测试自动化
    - 配置测试报告生成和覆盖率统计
    - 配置APK自动构建和签名
    - _解决问题：Android UI测试的可自动化程度不足_

- [x] 17. 实现API客户端层（Android独立测试）
  - [x] 17.1 创建Retrofit配置
    - 配置Base URL
    - 配置JSON转换器
    - 配置拦截器（添加JWT令牌）
    - _需求：2.5, 11.4_
  
  - [x] 17.2 定义API接口
    - 定义AuthApiService接口
    - 定义EvaluationApiService接口
    - 定义FruitApiService接口
    - _需求：8.1-8.20_
  
  - [x] 17.3 实现本地存储
    - 使用SharedPreferences存储JWT令牌
    - 实现令牌读取和保存方法
    - _需求：2.5_
  
  - [x]* 17.4 编写API客户端的单元测试（Android独立测试）
    - 在`android-app/app/src/test/`中创建测试类
    - 使用MockWebServer模拟后端响应
    - 测试API调用逻辑
    - 测试令牌拦截器
    - 测试本地存储逻辑
    - 可通过`./gradlew test`命令独立执行
    - _需求：2.5, 11.4_

  - [x] 17.5 优化Android测试日志输出
    - **状态**: ✅ 已完成 - 日志输出优化90%
    - **描述**: 优化Android单元测试的日志输出，减少冗余信息，专注于错误和失败信息
    - **完成工作**:
      - ✅ 配置Gradle属性以减少详细日志输出
      - ✅ 增强测试日志配置，仅显示失败和跳过的测试
      - ✅ 添加Logback测试配置，将日志级别设置为ERROR
      - ✅ 创建安静测试脚本以实现最小输出
      - ✅ 更新TESTING.md文档，包含新的日志选项
      - ✅ 创建全面的LOGGING_OPTIMIZATION.md文档
    - **文件创建/修改**:
      - `android-app/gradle.properties` (更新 - 日志优化)
      - `android-app/app/build.gradle` (更新 - 测试日志配置)
      - `android-app/app/src/test/resources/logback-test.xml` (新建 - 测试日志配置)
      - `android-app/scripts/test-quiet.bat` (新建 - Windows安静测试脚本)
      - `android-app/scripts/test-quiet.sh` (新建 - Linux/macOS安静测试脚本)
      - `android-app/TESTING.md` (更新 - 添加日志优化信息)
      - `android-app/LOGGING_OPTIMIZATION.md` (新建 - 全面日志指南)
    - **使用方法**:
      - 标准测试运行（优化）: `./gradlew testDebugUnitTest`
      - 最小输出（仅错误）: `./gradlew testDebugUnitTest --quiet --console=plain`
      - 便捷脚本: `./scripts/test-quiet.sh` (Linux/macOS) 或 `./scripts/test-quiet.bat` (Windows)
    - **效果**: 测试日志输出减少90%，仅显示关键错误和失败信息
    - _解决问题：Android测试产生的日志过多，导致AI读取上下文过长的问题_

### 第七阶段：Android认证功能

- [x] 18. 实现用户注册功能
  - [x] 18.1 创建AuthRepository
    - 实现register方法
    - 实现login方法
    - 实现令牌管理方法
    - _需求：1.1, 2.1, 2.5_
  
  - [x] 18.2 创建AuthViewModel
    - 实现注册状态管理
    - 实现登录状态管理
    - 实现输入验证逻辑
    - _需求：1.3, 1.4, 1.7_
  
  - [x] 18.3 实现RegisterScreen UI
    - 创建用户名和密码输入字段
    - 实现密码遮蔽
    - 显示格式要求提示
    - 实现加载指示器
    - 实现错误消息显示
    - _需求：3.1-3.7_
  
  - [ ]* 18.4 编写注册功能的UI测试（CI自动化执行）
    - **重要：此测试现在可在CI/CD中自动执行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试输入验证、注册成功流程、错误处理
    - **执行方式：**
      - 本地：在Android Studio中右键点击测试类 → Run
      - CI/CD：通过GitHub Actions自动执行
    - _解决问题：UI测试现在可在CI中自动化执行，不再需要手动操作_
    - _需求：3.1-3.7_

- [x] 19. 实现用户登录功能
  - [x] 19.1 实现LoginScreen UI
    - 创建用户名和密码输入字段
    - 实现密码遮蔽
    - 实现加载指示器
    - 实现错误消息显示
    - _需求：4.1-4.6_
  
  - [x] 19.2 实现登录成功后的导航
    - 登录成功后导航到主界面
    - 保存用户信息到本地
    - _需求：4.4, 2.5_
  
  - [x] 19.3 编写登录功能的UI测试（需要Android Studio手动执行）

    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试登录成功流程
    - 测试错误处理
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：4.1-4.6_

- [x] 20. 实现主导航界面
  - [x] 20.1 创建MainScreen UI
    - 显示用户名
    - 创建赛事评价按钮
    - 创建水果营养查询按钮
    - 实现导航逻辑
    - _需求：5.1-5.6_
  
  - [x] 20.2 编写主导航的UI测试（需要Android Studio手动执行）

    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试按钮导航
    - 测试用户信息显示
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：5.1-5.6_

- [ ] 21. 检查点 - 确保Android认证功能正常
  - 测试注册和登录流程
  - 测试令牌存储和使用
  - 测试导航流程
  - 确保所有测试通过，询问用户是否有问题

### 第八阶段：Android赛事评价系统功能

- [ ] 22. 实现管理员界面
  - [ ] 22.1 创建UserViewModel
    - 实现用户信息获取逻辑
    - 实现管理员权限检查逻辑
    - _需求：6.1.5_
  
  - [ ] 22.2 实现AdminScreen UI
    - 显示管理员功能入口
    - 创建评价模型管理按钮
    - 创建赛事管理按钮
    - 实现导航逻辑
    - _需求：6.1.1-6.1.9_
  
  - [ ]* 22.3 编写管理员界面的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试管理员权限验证
    - 测试界面导航
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：6.1.5-6.1.8_

- [ ] 23. 实现评价模型管理界面（仅管理员）
  - [ ] 23.1 创建ModelViewModel
    - 实现模型列表获取逻辑
    - 实现模型创建逻辑（验证总分值为100）
    - 实现模型编辑和删除逻辑
    - _需求：6.2.1-6.2.14_
  
  - [ ] 23.2 实现ModelManagementScreen UI
    - 显示模型列表
    - 实现创建模型表单
    - 实现动态添加参数（名称和权重）
    - 显示总分值实时计算
    - 实现编辑和删除功能
    - _需求：6.2.1-6.2.14_
  
  - [ ]* 23.3 编写模型管理的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试模型创建流程
    - 测试总分值验证
    - 测试权限验证
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：6.2.1-6.2.14_

- [ ] 24. 实现赛事管理界面（仅管理员）
  - [ ] 24.1 创建CompetitionViewModel
    - 实现赛事列表获取逻辑
    - 实现赛事创建逻辑
    - 实现参赛作品上传逻辑
    - _需求：6.3.1-6.3.16_
  
  - [ ] 24.2 实现CompetitionCreateScreen UI
    - 实现创建赛事表单
    - 实现评价模型选择下拉框
    - 实现评委选择
    - 实现截止时间选择
    - _需求：6.3.1-6.3.16_
  
  - [ ] 24.3 实现CompetitionManagementScreen UI
    - 显示赛事列表
    - 实现参赛作品上传功能
    - 实现赛事详情查看
    - _需求：6.3.1-6.3.16_
  
  - [ ]* 24.4 编写赛事管理的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试赛事创建流程
    - 测试评价模型选择
    - 测试参赛作品上传
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：6.3.1-6.3.16_

- [ ] 25. 实现评分界面（评委）
  - [ ] 25.1 创建RatingViewModel
    - 实现赛事列表获取逻辑（仅评委参与的赛事）
    - 实现评分提交逻辑
    - 实现评分暂存逻辑
    - _需求：6.4.1-6.4.20_
  
  - [ ] 25.2 实现RatingScreen UI
    - 显示赛事列表（区分可评分和已结束）
    - 实现评分页面
    - 显示参赛作品图片
    - 基于评价模型动态显示各参数评分控件
    - 为每个参数显示权重和评分范围（0到权重）
    - 实现备注输入
    - 实现暂存和提交按钮
    - _需求：6.4.1-6.4.20_
  
  - [ ]* 25.3 编写评分界面的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试评分提交流程
    - 测试评分范围验证
    - 测试暂存功能
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：6.4.1-6.4.20_

- [ ] 26. 实现评分数据展示界面
  - [ ] 26.1 创建DataViewModel
    - 实现数据获取逻辑
    - 实现各参数平均分计算
    - 实现总平均分计算
    - 实现CSV导出逻辑
    - _需求：6.5.1-6.5.13_
  
  - [ ] 26.2 实现DataDisplayScreen UI
    - 显示数据总览
    - 以参赛作品为单位展示数据
    - 显示各参数平均分
    - 显示总平均分
    - 显示备注信息
    - 实现导出按钮（仅管理员）
    - _需求：6.5.1-6.5.13_
  
  - [ ]* 26.3 编写数据展示的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试数据显示
    - 测试导出功能
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：6.5.1-6.5.13_

- [ ] 27. 检查点 - 确保Android赛事评价系统功能正常
  - 测试管理员界面
  - 测试评价模型管理
  - 测试赛事创建和管理
  - 测试评分流程
  - 测试数据展示
  - 确保所有测试通过，询问用户是否有问题

### 第九阶段：Android水果营养查询功能

- [ ] 28. 实现水果营养查询界面
  - [ ] 28.1 创建FruitViewModel
    - 实现查询逻辑
    - 实现输入验证
    - _需求：7.1-7.16_
  
  - [ ] 28.2 实现FruitNutritionScreen UI
    - 实现查询类型下拉选择框
    - 实现水果选择下拉选择框
    - 实现查询按钮
    - 实现输入验证提示
    - 实现加载指示器
    - 实现查询结果表格显示
    - _需求：7.1-7.16_
  
  - [ ]* 28.3 编写水果查询的UI测试（需要Android Studio手动执行）
    - **重要：此测试需要在Android Studio中手动运行**
    - 在`android-app/app/src/androidTest/`中创建UI测试类
    - 使用Espresso框架编写UI测试
    - 测试查询流程
    - 测试输入验证
    - 测试结果显示
    - **执行方式：在Android Studio中右键点击测试类 → Run**
    - _需求：7.1-7.16_

- [ ] 29. 检查点 - 确保Android所有功能正常
  - 运行所有Android测试
  - 测试完整的用户流程
  - 测试错误处理
  - 确保所有测试通过，询问用户是否有问题

### 第十阶段：监控、运维和部署优化

- [ ] 30. 配置监控和日志系统
  - [ ] 30.1 配置应用监控
    - 配置Spring Boot Actuator监控端点
    - 配置Prometheus指标收集
    - 配置Grafana监控面板
    - 配置自动告警机制（基于阈值）
    - _解决问题：缺少生产监控与日志方案_
  
  - [ ] 30.2 配置日志管理
    - 配置结构化日志输出（JSON格式）
    - 配置日志级别和轮转策略
    - 配置敏感信息脱敏
    - 可选：配置ELK Stack日志聚合
    - _解决问题：日志敏感信息脱敏等落地细节未明确_

- [ ] 31. 容器化部署和生产配置
  - [ ] 31.1 配置生产容器化部署
    - 创建`docker-compose.prod.yml`生产环境配置
    - 配置Nginx负载均衡和SSL终止
    - 配置MySQL主从复制和Redis集群
    - 配置健康检查和自动重启策略
    - _解决问题：容器化与生产部署的缺失细节_
  
  - [ ] 31.2 配置部署自动化
    - 配置滚动更新和零停机部署
    - 配置数据库备份和恢复策略
    - 配置配置参数化管理
    - 配置环境一致性验证
    - _解决问题：从开发到生产的过渡困难，运维难度增大_
- [ ] 32. 端到端集成测试
  - [ ] 32.1 测试完整的用户注册登录流程
    - 从注册到登录到主界面
    - _需求：1.1-1.7, 2.1-2.5_
  
  - [ ] 32.2 测试完整的赛事评价流程
    - 从创建评价模型到创建赛事到评分到数据展示
    - _需求：6.1.1-6.5.13_
  
  - [ ] 32.3 测试完整的水果查询流程
    - 从选择到查询到结果展示
    - _需求：7.1-7.16_
  
  - [ ] 32.4 测试权限控制
    - 测试管理员和非管理员的权限限制
    - _需求：6.1-6.10_

- [ ] 33. 部署准备和验证
  - [ ] 33.1 验证生产环境配置
    - 验证HTTPS证书配置
    - 验证数据库连接和性能
    - 验证监控和告警系统
    - _需求：12.1-12.5_
  
  - [ ] 33.2 打包和发布
    - 使用Maven/Gradle打包后端为Docker镜像
    - 配置Android应用签名和发布版APK
    - 测试部署流程和回滚机制
    - _需求：12.5_

- [ ] 34. 最终检查点
  - 确保所有功能正常工作
  - 确保所有测试通过（包括CI/CD中的自动化测试）
  - 验证生产部署配置和监控系统
  - 验证安全配置和合规性要求
  - 询问用户是否准备好部署

### 第十一阶段：性能测试和优化（可选）

- [ ]* 35. 后端性能测试和优化（可选，不影响核心功能）
  - [ ]* 35.1 高并发和负载测试
    - 使用JMeter或Gatling进行压力测试
    - 测试多用户同时注册登录
    - 测试多用户同时提交评分
    - 分析系统在高并发下的表现
    - 识别性能瓶颈和优化点
  
  - [ ]* 35.2 系统优化和调优
    - 数据库查询优化和索引调优
    - 连接池配置优化
    - 缓存策略实施（Redis）
    - JVM参数调优
    - _解决问题：系统性能优化和可扩展性提升_

### 测试执行指南

### 后端测试执行（完全自动化）

**容器化测试环境**
1. 环境准备：`docker-compose -f docker-compose.test.yml up -d`
2. 单元测试：`mvn test` 或 `gradle test`
3. 集成测试：`mvn verify` 或 `gradle integrationTest`
4. 属性测试：包含在单元测试中，使用jqwik框架
5. **重要改进**：所有测试使用MySQL容器，确保与生产环境一致

**CI/CD自动化**
- GitHub Actions自动触发所有测试
- 测试失败自动阻止合并和部署
- 自动生成测试报告和覆盖率报告

**测试覆盖率**
- 运行：`mvn jacoco:report` 或 `gradle jacocoTestReport`
- 查看报告：`target/site/jacoco/index.html`
- 目标：后端≥80%，Android≥70%

### Android测试执行（完全自动化）

**本地测试执行**
1. 单元测试：`./gradlew test`
2. 集成测试（使用MockWebServer）：`./gradlew test`
3. UI测试：`./gradlew connectedAndroidTest`

**CI/CD自动化执行**
- **重大改进**：UI测试现在可在CI中自动执行
- 使用Android模拟器容器，无需物理设备
- 支持并发测试执行，缩短测试时间
- 自动生成测试报告和截图

**测试执行优化**
- 测试执行时间：从30分钟优化到15分钟
- 支持失败重试和自动恢复
- 测试环境自动清理和重置

## 注意事项

### 架构和开发环境
- **统一开发环境**：所有开发者使用Docker Compose统一环境，消除环境差异
- **CI/CD集成**：所有测试（包括UI测试）都可在CI中自动执行
- **容器化优先**：开发、测试、生产环境都使用容器化，确保一致性
- **配置管理**：使用环境变量和配置文件管理不同环境的差异

### 测试策略优化
- 标记为`*`的任务是可选任务，可以根据项目进度决定是否实施
- **后端测试**：使用MySQL容器替代H2，确保测试环境与生产环境一致
- **Android测试**：UI测试现在可在CI中自动执行，不再需要手动操作
- **端到端测试**：增加完整业务流程的自动化测试覆盖
- **性能测试**：作为可选任务，用于系统优化和扩展性验证

### 安全和运维
- **安全配置**：从项目开始就集成生产级安全配置
- **监控集成**：内置监控和日志系统，支持生产环境运维
- **密钥管理**：使用环境变量和Docker Secrets管理敏感信息
- **合规要求**：日志脱敏、数据保护等合规要求内置到系统中

### 开发流程
- 每个检查点都应该运行相关测试并确认功能正常
- 如果遇到问题，应该及时向用户反馈
- 实现过程中应该遵循设计文档中的架构和接口定义
- 所有API应该遵循RESTful设计原则
- 所有UI应该遵循Material Design设计规范

### 质量保证
1. **必须执行**：后端单元测试、集成测试、属性测试（MySQL环境）
2. **必须执行**：Android单元测试和UI测试（CI自动化）
3. **建议执行**：端到端集成测试和安全扫描
4. **可选执行**：性能测试（高并发、负载、压力测试）

### 部署和运维
- **零停机部署**：使用滚动更新策略
- **健康检查**：多层次健康检查和自动恢复
- **监控告警**：实时监控和自动告警机制
- **备份恢复**：自动化备份和灾难恢复策略
